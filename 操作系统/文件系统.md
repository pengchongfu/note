# 文件系统

## 4.1 文件

### 4.1.1 文件命名
大小写长度的区别

### 4.1.2 文件结构
字节序列

### 4.1.3 文件类型
普通文件和目录
unix：字符特殊文件、块特殊文件

普通文件：ASCII文件和二进制文件

### 4.1.4 文件存取
顺序存取、随机存取

### 4.1.5 文件属性

### 4.1.6 文件操作
- create
- delete
- open 把文件属性和磁盘地址表装入内存
- close
- read
- write
- append write的限制形式
- seek
- get attributes
- set attributes
- rename 不是很必要

### 4.1.7 示例程序

## 4.2 目录

### 4.2.1 一级目录系统
用在一些嵌入式装置中

### 4.2.2 层次目录系统
### 4.2.3 路径名
绝对目录和相对目录

### 4.2.4 目录操作
- create
- delete
- opendir
- closedir
- readdir
- rename
- link
    - 符号链接跨越磁盘
    - 硬链接效率高
- unlink

## 4.3 文件系统的实现
### 4.3.1 文件系统布局
MBR
### 4.3.2 文件的实现
1. 连续分配
    - CD-ROM中采用，因为文件大小确定
2. 链表分配
    - 链表也在块中，指针空间影响操作
3. 内存中采用表的链表分配
    - 内存中有一个文件分配表（FAT）
    - 表项太多，不适合大磁盘
4. i节点
    - FAT与磁盘大小正比
    - i节点与要打开的文件个数正比

### 4.3.3 目录的实现
方法一： 文件属性存放在目录中
i节点： 存放在i

文件名：
    - 在行中存储浪费空间
    - 在堆中有空洞

目录中查找文件都是线性的，可以用散列表

### 4.3.4 共享文件
硬链接：计数器在i节点上

### 4.3.5 日志结构文件系统
LFS
写操作太零散，但是i节点必须立即写，以免文件系统不一致

磁盘结构化为日志，每隔一段时间在日志末尾邻接段写入磁盘

### 4.3.6 日志文件系统
LFS面对出错的鲁棒性被借鉴，保存一个接下来要干嘛的日志，崩溃重启之后执行。

日志文件系统的操作必须是幂等的。

### 4.3.7 虚拟文件系统
标准的POSIX系统调用

## 4.4 文件系统管理和优化
### 4.4.1 磁盘空间管理

1. 按照固定大小的块存储，不一定相邻
    - 太大浪费磁盘空间
    - 太小寻址效率低
2. 记录空闲块
    - 链表
    - 位图
3. 磁盘配额

### 4.4.2 文件系统备份
物理转储
逻辑转储

### 4.4.3 文件系统的一致性

### 4.4.4 文件系统性能
1. 高速缓存
    - 逻辑上属于磁盘，但是保存在内存里
    - 页面置换算法
2. 块提前预读
3. 减少磁盘臂运动

### 4.4.5 磁盘碎片整理

## 4.5 文件系统实例

## 4.6 有关文件系统的研究


