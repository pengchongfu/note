# 第6章

难点：提高并发的同时使每个用户能够一致地读取和修改数据

锁机制用于管理对共享资源的并发访问，锁是数据库系统区别于文件系统的一个关键特性

latch 轻量级的锁 mutex 和 rwlock，无死锁检测机制
lock 的对象是事务，用来锁定数据库中的对象

InnoDB 实现的行级锁
- 共享锁：允许事务读一行数据
- 排他锁：允许事务删除或更新一行数据

意向锁：表级

一致性非锁定读（不加锁）：事务进行过程中会有 undo 日志（不会有额外开销），读取其中的快照而不是阻塞
一致性锁定读：加S或者X锁

自增长（用于主键）：新的实现通过互斥量而不是表锁

外键用的是锁定读

record lock：单个记录上的锁
gap lock：间隙锁，锁定一个范围
next-key lock：锁定范围和记录

锁问题：
- 脏读：不同事务：当前事务可以读到另外事务未提交的数据
- 不可重复读：同一事务多次读取，读到的数据不一样（与脏读的区别是读到的是已经提交的数据）
- 丢失更新：两个事务都提交。（串行执行）

死锁：使用超时或者等待图解决