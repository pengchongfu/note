## experiments
- A/A 测试：保证 A/B 测试的准确性
- 分层：支持多个实验并发进行
- sdk 通过定义好的文件计算变量，无网络 io
- 将队列中的数据按照 service name 分区，并且保存到分布式文件系统（s3）中（同时保存到实时处理cluster中）
- LSM 树，保存在内存中，设置一小时过期
- presto 的查询一小时内的直接实时处理，一小时以外的批处理得到结果

### 流程
1. 用户定义实验，设定开始结束时间
2. 计划执行器校验实验，保存并设定延时任务
3. 延时任务执行，推送配置到配置中心
4. sdk 监听配置变化，实验开始
5. 统计信息发送到统计网关
6. 网关推送到队列
7. 消费队列，保存为 orc 同时推到实时处理集群
8. 支持 presto 批处理以及实时查询
9. 实验结束，生成报告

#### client sdk
- 使用哈希保证百分比的结果是可重复的
- 变量名+参数（用户id，城市id）-> 根据变量名获取相关层 -> 层之内按照城市分桶 -> 再根据用户id划分的不同实验上
- trie：根据 geohash 确定对应的 cityid

#### redis 延时任务
- 有序集合，按执行时间排序，保存任务id
- 任务详情保存在键值对中
- 轮询有序集合，找到一个在 0 和 now 之间的任务（ZRANGEBYSCORE key 0 now limit 0 1）
