# 数据结构与对象

## 简单动态字符串（SDS）
- len
- free
- 字节数组指针

区别
- 常数复杂度获取字符串长度：原来是O(N)，现在是O(1)
- 杜绝缓冲区溢出
- 减少内存分配操作
    - 空间预分配
    - 惰性空间释放
- 二进制安全：因为C字符串不能包含空字符
- 兼容部分C字符串函数

## 链表
- 节点：
    - 前置节点指针
    - 后置节点指针
    - 值指针
- 链表：
    - 表头
    - 表尾
    - 节点数

特性总结：
- 双端，双向，获取前后节点都是O(1)
- 无环
- 获取头尾节点都是O(1)
- 节点数量O(1)
- 值为指针，可以保存不同类型数据

## 字典
哈希表
- 对应的数组
- 大小
- 掩码，等于 size-1
- 已有节点数量

哈希表节点
- 键
- 值（union 整数，或者指针）
- 下个节点指针

字典
- 特定类型函数（比如计算哈希值的）
- privateData 私有数据
- 哈希表数组（长度为2）
- rehash（记录进度）

### 哈希算法
要求随机分布、速度快

### rehash
1. ht[1] 分配空间
2. 重新计算
3. 释放 ht[0]

### 渐进式 rehash
- 删除查找更新同时在两个表执行
- 新增直接在 ht[1] 里
- 将计算量平摊到每次操作上


## 跳跃表
todo

## 整数集合
intset
- encoding 方式
- 元素个数
- 8位数组（按大小顺序放置元素）

由 encoding 方式决定每个元素的位数

### 升级
1. 增加空间
2. 改变原有元素类型
3. 放入新元素

升级时新放入的元素要不是最大的，要不是最小的

- 升级更灵活，不需要写死类型
- 节省内存

### 降级
不支持

## 压缩列表

为了节省内存而开发
todo

## 对象
1. 字符串
2. 列表
3. 哈希
4. 集合
5. 有序集合

### 对象的类型和编码
对象
- 类型（以上5种）
- 编码（底层数据类型）
- 指针
- 引用计数器

可以自动改变编码以提高效率

### 字符串对象
编码为整数可以节省空间

### 列表对象
链表或者压缩表

### 哈希对象
压缩表或者哈希表

### 集合对象
intset 或者哈希表

### 有序集合对象
压缩列表或者跳表

## 类型检查和多态
## 内存回收
引用计数（todo：如何解决循环引用）

## 对象共享
共享底层数据
（0到9999整数是共享的）

## 对象空转时长
lru:上次访问的时间戳）

