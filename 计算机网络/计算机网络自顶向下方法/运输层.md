# 运输层

## 3.1 概述和运输层服务

## 3.2 多路复用与多路分解

将运输层报文段中的数据交付到正确的套接字的工作叫做多路分解

源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息从而生成报文段，然后传递到网络层，叫做多路复用

## 3.3 无连接运输：UDP
UDP无非是对网络层协议增加了一点多路复用与多路分解服务而已

- UDP报文段结构：源端口号、目的端口号、长度、检验和、报文
- UDP检验和：无法进行差错恢复，直接丢弃或者交由应用程序

## 3.4 可靠传输原理
如何解决流水线的差错恢复：回退N步和选择重传

## 3.5 面向连接的运输：TCP
最大报文段长度MSS
最大链路层帧长度MTU

TCP报文段结构：源端口号、目的端口号、序号、确认号、首部长度、校验和、选项、数据
（没有长度字段是因为可以通过ip数据报确认）

TCP采用累积确认，只确认流中至第一个丢失为止的字节

连接管理
- 首部SYN置为1，并随机选择初始序号
- SYN也置为1，确认字段+1，并且也选择自己的初始序号
- SYN为0，确认字段+1，并且可以在报文段中携带数据

## 3.6 拥塞控制原理

方法：
- 端到端拥塞控制：因为网络层不提供支持
- 网络层显示反馈信息

## 3.7 TCP拥塞控制
- 如何控制发送速率：拥塞窗口（发送缓存？）
- 拥塞检测：超时或者收到冗余ACK
- 用什么算法改变发送速率？

TCP拥塞控制算法
1. 慢启动
    - 开始只发送一个报文段，cwnd=1MSS
    - 慢启动阶段指数增长
    - 检测到拥塞，cwnd=1MSS，ssthresh=cwnd/2，到达该值时进入拥塞避免模式
2. 拥塞避免
    - 每次增加一个MSS字节
    - 丢包时，cwnd加上3ACK和3MSS之后减半，进入快速恢复状态
3. 快速恢复状态
