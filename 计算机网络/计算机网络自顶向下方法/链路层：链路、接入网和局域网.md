# 链路层：链路、接入网和局域网

- 广播信道
- 点对点通信链路

## 5.1 链路层概述

链路层提供的服务
- 成帧，很多种帧格式
- 链路接入，点对点简单，广播需要解决冲突，MAC（medium access control）协议用于协调
- 可靠交付，许多有线链路不提供可靠交付
- 差错检测和纠正

链路层协议主要在网络适配器中实现

## 5.2 差错检测和纠正技术

1. 奇偶校验
2. 检验和，运输层使用比较简单
3. 循环冗余检测（CRC）

## 5.3 多路访问链路和协议

期望拥有的特性
1. 只有一个节点是，具有全部吞吐量
2. 广义的平均传输速率
3. 协议分散，不容易主节点故障而奔溃
4. 协议简单不昂贵  
--- 
1. 信道划分协议
时分复用、频分复用，不满足1
码分多址

2. 随机接入协议
    1. 时隙ALOHA
    2. ALOHA
    3. 载波侦听多路访问，为什么侦听了还会发生碰撞？和传播时延有关，但是依旧不满足2

3. 轮流协议
    - 轮询协议：通过主节点确定需要发送的帧数量
    - 令牌传递协议：容易奔溃

## 5.4 交换局域网

链路层寻址和ARP
1. MAC地址
- 长度为6字节，可以用软件改变
- MAC是扁平结构，IP是层次结构，会变
- 广播地址 FF-FF-FF-FF-FF-FF

2. 地址解析协议（ARP）
- DNS为任何主机解析主机名，ARP只为同一个子网上的主机和路由器解析IP
- ARP表，TTL一般为20分钟
- ARP分组封装在链路层帧中，广播发送；跨越链路层和网络层
- ARP中寻址的可以是子网地址，也可以是外网地址，外网地址由路由器响应

以太网
- 集线器：只是放大信号并广播
- 交换机：无碰撞的，并且支持存储转发

以太网帧结构：
- 数据字段，MTU是1500字节
- 目的地址
- 源地址
- 类型字段
- CRC，4字节
- 前同步码，发送方和接收方同步时钟

以太网技术：
- 使用 CSMA/CD 共享广播信道
- 交换机的以太局域网没有必要使用MAC协议
- 交换机转发和过滤：交换机表
- 交换机自学习

交换机的性质：
- 消除碰撞
- 异质的链路
- 管理，可以记录各种流量数据

交换机和路由器的比较
- 即插即用
- 主机和路由器都必须保存大量ARP
- 广播风暴无法限制

## 5.5 链路虚拟化

## 5.6 数据网络中心

负载平衡
- 第四层交换机：基于分组的端口号（第四层）和IP做决策

## 5.7 回顾：web页面请求的历程
连接交换机，下载web页面

1. 准备：DHCP、UDP、IP和以太网
- DHCP请求报文=>UDP报文段=>IP数据报=>以太网帧
- DHCP ACK报文：分配的IP地址、子网块、DNS服务器IP地址、网关路由器的IP地址

2. 仍在准备：DNS和ARP
- DNS查询报文=>ARP获取网关路由器的MAC地址

3. 仍在准备：域内路由器选择到DNS服务器

4. web客户 - 服务器交互
- TCP：三次握手
- HTTP请求